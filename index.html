<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thinking in React</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        class ProductCategoryRow extends React.Component {
            render() {
                const category = this.props.category;
                return (
                    <tr>
                        <th colSpan="2">{category}</th>
                    </tr>
                );
            }
        }

        class ProductRow extends React.Component {
            render() {
                const product = this.props.product;
                const name = product.stocked ? product.name : <span style={{ color: 'red' }}>{product.name}</span>;
                return (
                    <tr>
                        <td>{name}</td>
                        <td>{product.price}</td>
                    </tr>
                );
            }
        }

        class ProductTable extends React.Component {
            render() {
                const allCategoryValues = this.props.products.map(product => product.category);
                const categories = allCategoryValues.filter((item, index) => allCategoryValues.indexOf(item) === index);

                let tbody = [];

                categories.map(category => {
                    const categoryRowComponent = <ProductCategoryRow key={tbody.length} category={category} />;
                    tbody.push(categoryRowComponent)

                    this.props.products.forEach(product => {
                        const findWord = product.category.includes(category);
                        if (findWord) {
                            const productRowComponent = <ProductRow key={tbody.length} product={product} />;
                            return tbody.push(productRowComponent);
                        }
                    })
                });

                return (
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            {tbody}
                        </tbody>
                    </table>
                );
            }
        }

        class FilterableProductTable extends React.Component {
            render() {
                return (
                    <>
                        <ProductTable products={this.props.products} />
                    </>
                )
            }
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<FilterableProductTable products={PRODUCTS} />);
    </script>
</body>

</html>